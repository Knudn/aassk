<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaceLab Stream Overlay</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #121212; /* Dark background */
            color: #fff;
            margin: 0;
            overflow: hidden;
        }
        .container {
            padding: 10px;
        }
        .main_menu {
            text-align: center;
            margin-bottom: 15px;
        }
        .race-wrapper {
            display: flex;
            justify-content: space-between;
            background-color: #1e1e1e;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        .driver-container {
            display: flex;
            align-items: center;
        }
        .driver-card {
            display: flex;
            align-items: center;
            margin-right: 15px;
            font-size: 14px;
        }
        .driver-name {
            font-weight: 500;
        }
        .driver-club, .driver-vehicle {
            color: #a0a0a0;
            font-size: 12px;
        }
        .race-id {
            background-color: #ff3b3b;
            color: #fff;
            border-radius: 50%;
            padding: 5px;
            font-size: 12px;
            text-align: center;
            width: 25px;
            height: 25px;
            line-height: 25px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main_menu">
            <h1 id="Startliste">Driver Lineup</h1>
        </div>
        <div id="startlist">
            <!-- Content will be populated here -->
        </div>
    </div>
    <script>
        let currentPage = 1;
        const recordsPerPage = 20;
        let paginatedData = [];

        function fetchDataFromAPI() {
            fetch('http://192.168.1.50:7777/api/get_current_startlist_w_data')
                .then(response => response.json())
                .then(data => {
                    renderData(data);
                })
                .catch(error => {
                    console.error('Error fetching initial data:', error);
                });
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            fetchDataFromAPI();
        });

        function renderData(data) {
            // Create paginated data
            paginatedData = [];
            while (data.length) {
                paginatedData.push(data.splice(0, recordsPerPage));
            }
            displayPage(currentPage);
        }
        let autoSwitchPageTimeout;
        function displayPage(pageNumber) {
            clearTimeout(autoSwitchPageTimeout);
            if (!paginatedData[pageNumber - 1]) return;

            const startlistDiv = document.getElementById('startlist');
            startlistDiv.innerHTML = '';
            

            paginatedData[pageNumber - 1].forEach(race => {
                let raceDiv = document.createElement('div');
                raceDiv.classList.add('race-wrapper');

                let driversDiv = document.createElement('div');
                driversDiv.classList.add('driver-container');

                console.log(race.drivers)
                if (race.drivers && Array.isArray(race.drivers)) {
                console.log(race.drivers[0].active)
                
                driversDiv.innerHTML = `
                    <div class="driver-card left-card">
                        <div class="driver-name">${race.drivers[0].first_name} ${race.drivers[0].last_name} [${race.drivers[0].id}]</div>
                        <div class="driver-info">
                            <div class="driver-club">${race.drivers[0].club}</div>
                            <div class="driver-vehicle">${race.drivers[0].vehicle}</div>
                        </div>
                    </div>
                    <div class="race-id">${race.race_id}</div>`;
                
                if (race.drivers[1]) {
                    driversDiv.innerHTML += `
                    <div class="driver-card right-card">
                        <div class="driver-name">[${race.drivers[1].id}] ${race.drivers[1].first_name} ${race.drivers[1].last_name} </div>
                        <div class="driver-info">
                            <div class="driver-club">${race.drivers[1].club}</div>
                            <div class="driver-vehicle">${race.drivers[1].vehicle}</div>
                        </div>
                    </div>`;
                }
                
                if (race.drivers[0].active || race.drivers[1].active) {

                    let driverCards = driversDiv.querySelectorAll('.race-id');
                    driverCards.forEach(card => {
                        card.style.transform = 'scale(2)';
                    });
                }
                if (race.drivers[0].status == 0 & race.drivers[1].status == 0) {
                    raceDiv.appendChild(driversDiv);
                    startlistDiv.appendChild(raceDiv);

                }
            }



            });

    }



    </script>
</body>
</html>
